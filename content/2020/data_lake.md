Title: 浅谈数据湖
Date: 2020-10-13 15:02:53
Category: 数据仓库
Tags: data-warehouse, data-lake
CommentId: X


## 什么是数据湖？

<!-- PELICAN_END_SUMMARY -->

数据湖（Data Lake）这个由 Pentaho 的 James Dixon 提出的术语，并没有一个精确的定义。随着大数据[ps: 主要是Hadoop。]热潮的兴起出现，在云服务商提供自己版本的“云上大数据平台”过程中炒热。所以关于数据湖的定义就有很多版本，基本上都声称有以下几个特性：

1. 数据湖不是数据仓库。
2. 数据湖存储容量极大，足以保存一个企业/组织中的所有数据。
3. 数据湖中可以存储海量的任意类型的数据，包括结构化、半结构化和非结构化数据。也就是保存的是原始数据，这些数据保持了它们在业务系统中原本的样子。
4. 数据湖具备多样化的分析能力，包括但不限于批处理、流式计算、交互式分析以及机器学习。

简单地说，狭义的数据湖指的是数据湖存储[ps: 最好是存储在 HDFS 或者云上的对象存储系统上。]，就是一个原始数据保存区。广义的数据湖除了数据湖存储，还包括数据湖的管理和分析，即提供一整套工具，提供数据目录（Data Catalog）服务以及统一的数据访问。有些厂商甚至把数据处理任务的调度和管理也当作数据湖的组成部分。

数据湖的相关词汇:

- Data Lake: 数据湖。
- Data Swamp: 数据沼泽，也叫单向湖。
- Data River: 数据河。

只被往里面灌数据，而极少甚至没有输出的数据湖，就被成为单向湖，或叫数据沼泽。

数据河就是在由数据源头就产生清晰干净的有效[ps: 所谓的去 ETL 化，数据源头业务就像生态水源一样，不让污水流下去。]数据，通过各个河流网（传输管道）流向各个数据消费端。

![典型的数据湖（出自Databricks）](/images/2020/making-apache-spark-better-with-delta-lake-2-638.jpg)

## 现有的数据湖产品
### 开源产品

目前，最有名的开源数据湖产品有 Netflix 的 Apache Iceberg、Databricks 的 Delta Lake 和 Uber 的 Apache Hudi 。

### DaaS

Data Lake as a Service ，就是云服务商提供的数据湖服务。如 Snowflake、亚马逊的 AWS Lake Formation 的[ps: AWS Lake Formation 基本上就是抓取数据源并将数据移动到 Amazon S3 中并构建一个数据目录，该目录描述可用的不同数据集以及哪些用户组可以访问每个数据集。在这个过程中，可以选择将数据转换为 Apache Parquet 或 ORC 等(说好的存储任意格式，保留原来的样子呢？)格式，可以做些去重的操作。]服务、微软 Azura 的 Data Lake Storage + Data Lake Analytics / HDInsight [ps: Azura Analytics 更像是个 BI 工具，而 Azura HDInsight 是 Hadoop 生态圈工具集合。] 、国内阿里云华为云也有相应的产品。

这类服务通常要求用户将数据源通过接入服务存储到云上的数据湖中，使用数据时，再用同一家服务商的云上分析/计算/AI服务来对数据进行处理。用户可以省去很多运维上的麻烦，并且只需支付[ps: 但是这些云服务通常都不便宜 ^0^ ]存储和实际计算产生的费用。

### 自实现服务

有的企业不希望将自己的数据直接存储到云服务商那里，会选择自己建立数据湖服务。这种情况下，通常自建的数据湖要么指的就是 Hadoop Data Lake (什么都往HDFS上扔)，要么就是某种 RDBMS+Hadoop/Spark/Flink+MPP 的混合架构。相对于使用 DaaS ，自建服务在数据治理、安全管理上需要企业自己的技术团队所花费[ps: 但是自建服务花的钱可能会更少 ^0^]的时间精力通常会更多。


## 我的看法

先说我总的看法：狭义的数据湖有一定存在的意义，对某些场景的需求有比传统数仓更好的支持；广义的数据湖则是一个大“坑”，一个纯粹的营销词汇。

在数据仓库的架构里，本来就存在对海量的原始数据存储区域，对接各种异构的结构化或非结构化的数据源，也为数据血缘管理所覆盖。这些不是数据湖的首创。单独把这个存储子系统分离出来，称为数据湖，是有一定意义的。因为过去的数据仓库体系里，这个原始数据的存储区域往往不对终端用户开放。终端用户只能访问数据仓库或者数据集市中，经过建模和处理后的数据。现在很多情况下(特别是互联网行业)，数据的需求很不明确、业务经常性地变动，或者需要频繁地对原始的数据进行探索。传统的数仓的原始数据经过数仓再到应用端给用户访问的链条太长了，对这些类型的需求的支持不够。

现在为这个存储区域加上权限控制、数据目录，然后让终端用户[ps: 包括人类用户和程序]也可以访问。这就能更快速地适应上层数据应用的变化。这就是狭义的数据湖，确实扩展了数据仓库的能力。

广义的数据湖就是一个概念箩筐，什么都往里面装。它把数据采集、数据存储、数据治理、机器学习、数据分析等都涵盖了一通，基本上就是去除了建模的数据仓库。除了作为云服务商推销自己的云上大数据服务的营销词汇外，没有提供任何比数据仓库更好的新东西。数据仓库只是一个方法论，它的实现本身也在与时俱进。仅仅对它各个子系统的技术选型进行变更或者扩展了数据的用途，并不意味着一个新的概念就产生了。广义的数据湖并不是下一代的“数据仓库”。

更重要的是，隐藏在广义的数据湖背后的一些前提假设，使得建立/使用它的过程成为一个“大坑”。

广义的数据湖声称它“存储一切”。然而并不是所有的数据都值得存储，存储也是要成本的。纯粹地存储数据并不能提供什么价值，有句老话叫做 `Garbage in, garbage out.` ，看起来数据湖省去了 ETL ，实际上只是把数据转换、规范的操作复杂度与时间成本转移给了终端用户。特别对非互联网企业，许多数据的结构不像互联网行业那样简单。广义数据湖实际上会使得这些企业在存储和处理两个方面的成本都增加了。

如果你观察许多厂商画出来的数据湖架构图，你就会发现这些广义的数据湖实际上实现的是独立型数据集市架构[ps: 通常把数据仓库体系分为3种类型：Inmon的企业信息化工厂、Kimball的维度数据仓库和独立型数据集市。]。独立型数据集市被很多机构应用，因为它能迅速、廉价地获得结果。但是当企业的需求开始有多个主题区域时，这种架构短期的成功会带来长期的问题。

也许将来在这数据湖的热潮过后，最终能落地的是 `Data lakehouse` ，狭义的数据湖作为 repository ，在这之上是混合多种技术实现的数据仓库。
