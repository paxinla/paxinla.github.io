<!Doctype html>
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <base href="https://paxinla.github.io">
        <meta property="og:title" content="Blog of Charles" />
        <meta name="author" content="Charles" />
        <meta property="article:author" content="Charles" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://paxinla.github.io" />
        <meta property="og:image" content="https://paxinla.github.io/static/blog_url_qrcode.png" />
        <meta property="og:image:secure_url" content="https://paxinla.github.io/static/blog_url_qrcode.png" />
        <meta property="og:image:type" content="image/png" />
        <meta property="og:image:width" content="120" />
        <meta property="og:image:height" content="120" />
        <meta property="og:image:alt" content="A QR code of the blog's URL." />
        <meta property="og:description" content="This is the blog of Charles." />
        <meta name="copyright" content="Charles" />
        <meta name="description" content="Personal blog of Charles">
        <meta name="generator" content="pelican 3.7.1">
        <link href="https://paxinla.github.io/static/humans.txt" rel="author" type="text/plain" />
        <title>SQL练手题：Number of unique hackers who made at least one submission each day</title>
        <link href="https://paxinla.github.io/posts/2020/09/sqllian-shou-ti-number-of-unique-hackers-who-made-at-least-one-submission-each-day.html" rel="canonical" />

        <link href="https://paxinla.github.io/theme/images/favicon.ico" rel="icon" type="image/png" />
        <link href="https://paxinla.github.io/theme/images/safari-pinned-tab.svg" rel="mask-icon" color="#5bbad5" />

        <link href="https://paxinla.github.io/theme/css/blogstyle.css?6748a722" rel="stylesheet" type="text/css" />

        <!-- View Counter -->
        <script defer src="https://events.vercount.one/js"></script>
        <!-- End of View Counter Code -->

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-70MNYH18HG"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-70MNYH18HG');
        </script>
    </head>


    <body data-spy="scroll" data-target="#left-navbar" data-offset="50" itemscope="" itemtype="http://schema.org/WebPage">

        <!-- Cursor animation -->
        <script defer="" src="https://paxinla.github.io/theme/js/animejs.js"></script>
        <script defer="" src="https://paxinla.github.io/theme/js/fireworks.min.js"></script>
        <canvas class="fireworks" style="width:100%; height:100%;"></canvas>

        <div id="whole-page">
        <!-- Left Sidebar -->
        <nav id="left-navbar" class="sidebar">
            <div class="content">
                <div><a href="/"><img src="https://paxinla.github.io/static/icosahedron.jpg" class="img-responsive center-block" style="height:120px;width:120px;border-radius:20px;"/></a></div>
                <br/>
                <div class="center-text narrow-font" style="line-height: 28px;">
                    <span class="nav-item"><i class="fas fa-home"></i><a href="https://paxinla.github.io/"> 首页 </a></span>
                    <span class="center-dot"></span>
                    <span class="nav-item"><i class="fas fa-file-archive"></i><a href="https://paxinla.github.io/archives.html"> 过往文章 </a></span>
                    <br/>
                    <span class="nav-item"><i class="fas fa-tags"></i><a href="https://paxinla.github.io/tags.html"> Tag </a></span>
                    <span class="center-dot"></span>
                    <span class="nav-item"><i class="fa fa-archive"></i><a href="https://paxinla.github.io/categories.html"> Category </a></span>
                    <br/>
                    <span class="nav-item"><i class="fa fa-link"></i><a href="https://paxinla.github.io/links.html"> 友邻 </a></span>
                    <span class="center-dot"></span>
                    <span class="nav-item"><i class="fas fa-user"></i><a href="https://paxinla.github.io/about.html"> 关于我 </a></span>
                </div>
                <hr/> <br/>

<div class="title"><a href="#">SQL练手题：Number of unique hackers who made at least one submission each day</a></div>
<hr/>

                <div id="nav-sidebar">
                </div>

<br/>

                <div id="nav-visited-info" class="center-text floating-description">
                    <div id="copyright-expression" class="copyright"><span style="color:#6fdcdc;">(</span>cons "<a href="https://github.com/paxinla" style="color:#999;">Charles</a> <span style="color:#00ec47;">&copy;</span>" <span style="color:#ff188c;">(</span>iterate inc <span style="color:#db4437;">2014</span><span style="color:#ff188c;">)</span><span style="color:#6fdcdc;">)</span></div><br/>
                    <a id="powered-by" href="https://github.com/getpelican/pelican">Powered by <span id="icon-gear" class="rotating"></span><span style="color:#fbf3f3;"> Pelican</span></a><br/>
                    <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" style="border: none;" ><img src="https://img.shields.io/badge/License-CC__BY--NC--SA-blue.svg" style="height: 17px;" /></a>
                </div>
            </div>
        </nav>

        <!-- Middle and right sections -->
        <div class="page" itemsope="" itemtype="http://schema.org/Blog">
<div class="content-top" style="padding-right: 0">
    <div class="unit-line-height">
        <!-- Post Title -->
        <h1 class="title">
            <div>
                <span itemprop="name">SQL练手题：Number of unique hackers who made at least one submission each day</span>
            </div>
        </h1>

        <!-- Post Meta Info -->
        <div class="marginnote invisible-sm post-detail">
            <div>
                <p><div class="date heading-font"><i class="fa fa-calendar"></i> 2020-09-09 星期三</div>
                    <a href="#" style="margin-left:0.875em;border:none;">
                        <span class="author" itemprop="name">Charles</span>
                    </a>
                </p>

                <p><div class="heading-font"><i class="fas fa-folder"></i> Category</div>
                    <a class="category" href="https://paxinla.github.io/category/sqlxi-ti.html" style="margin-left:0.875em;border:none;">
                         SQL习题
                    </a>
                </p>

                <p><div class="heading-font"><i class="fas fa-tag"></i> Tags</div>
                    <span style="padding-left:1.4em;"></span>
                        <a class="tag" href="https://paxinla.github.io/tag/exercise.html">exercise</a>
                        <a class="tag" href="https://paxinla.github.io/tag/sql.html">sql</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Post Image -->
    <br/>
    <img src="" class="cover img-responsive" style="max-height: 400px" itemprop="image">
    <div class="note visible-sm post-detail"></div>

    <hr class="dotty-split-line" />
</div>

            <!-- Content -->
<div class="content"  id="content_of_post" style="padding-right: 0">
    <div class="post" itemprop="blogPost">
        <div id="content_of_article" class="justify word-break" itemprop="articleBody">
            <p>一道 hackerrank 的 SQL 题。</p>

<div id="section1"><h2>题目</h2>
<p>Julia conducted a 15 days of learning SQL contest. The start date of the contest was March 01, 2016 and the end date was March 15, 2016.</p>
<p>Write a query to print total number of unique hackers who made at least submission each day (starting on the first day of the contest), and find the <code>hacker_id</code> and <code>name</code> of the hacker who made maximum number of submissions each day. If more than one such hacker has a maximum number of submissions, print the lowest <code>hacker_id</code>. The query should print this information for each day of the contest, sorted by the date.</p>
<h3>Input Format</h3>
<p>The following tables hold contest data:</p>
<pre><code class="lang-vim hljs">
    - Hackers: The `hacker_id` is the id of the hacker, and
               name is the name of the hacker.

    | Column    | Type    |
    |-----------+---------|
    | hacker_id | Integer |
    | name      | String  |

    - Submissions: The `submission_date` is the date of
                   the submission, `submission_id` is
                   the id of the submission, `hacker_id` is
                   the id of the hacker who made
                   the submission, and score is
                   the score of the submission.

    | Column          | Type    |
    |-----------------+---------|
    | submission_date | Date    |
    | submission_id   | Integer |
    | hacker_id       | Integer |
    | score           | Integer |
</code></pre>
<h3>Sample Input</h3>
<p>For the following sample input, assume that the end date of the contest was March 06, 2016.</p>
<pre><code class="lang-vim hljs">
    - Hackers table

    | hacker_id  | name     |
    |------------+----------|
    | 15758      | Rose     |
    | 20703      | Angela   |
    | 36396      | Frank    |
    | 38289      | Patrick  |
    | 44065      | Lisa     |
    | 53473      | Kimberly |
    | 62529      | Bonnie   |
    | 79722      | Michael  |

    - Submissions table

    | submission_date | submission_id | hacker_id | score |
    |-----------------+---------------+-----------+-------|
    | 2016-03-01      |  8494         | 20703     | 0     |
    | 2016-03-01      |  22403        | 53473     | 15    |
    | 2016-03-01      |  23965        | 79722     | 60    |
    | 2016-03-01      |  30173        | 36396     | 70    |
    | 2016-03-02      |  34928        | 20703     | 0     |
    | 2016-03-02      |  38740        | 15758     | 60    |
    | 2016-03-02      |  42769        | 79722     | 25    |
    | 2016-03-02      |  44364        | 79722     | 60    |
    | 2016-03-03      |  45440        | 20703     | 0     |
    | 2016-03-03      |  49050        | 36396     | 70    |
    | 2016-03-03      |  50273        | 79722     | 5     |
    | 2016-03-04      |  50344        | 20703     | 0     |
    | 2016-03-04      |  51360        | 44065     | 90    |
    | 2016-03-04      |  54404        | 53473     | 65    |
    | 2016-03-04      |  61533        | 79722     | 45    |
    | 2016-03-05      |  72852        | 20703     | 0     |
    | 2016-03-05      |  74546        | 38289     | 0     |
    | 2016-03-05      |  76487        | 62529     | 0     |
    | 2016-03-05      |  82439        | 36396     | 10    |
    | 2016-03-05      |  90006        | 36396     | 40    |
    | 2016-03-06      |  90404        | 20703     | 0     |
</code></pre>
<h3>Sample Output</h3>
<ul>
<li>2016-03-01 4 20703 Angela</li>
<li>2016-03-02 2 79722 Michael</li>
<li>2016-03-03 2 20703 Angela </li>
<li>2016-03-04 2 20703 Angela </li>
<li>2016-03-05 1 36396 Frank </li>
<li>2016-03-06 1 20703 Angela</li>
</ul>
<h3>Explanation</h3>
<p>On March 01, 2016 hackers 20703, 36396, 53473 and 79722 made submissions. There are 4 unique hackers who made at least one submission each day. As each hacker made one submission, 20703 is considered to be the hacker who made maximum number of submissions on this day. The name of the hacker is Angela.</p>
<p>On March 02, 2016 hackers 15758, 20703 and 79722 made submissions. Now 20703 and 79722 were the only ones to submit every day, so there are 2 unique hackers who made at least one submission each day. 79722 made 2 submissions, and name of the hacker is Michael.</p>
<p>On March 03, 2016 hackers 20703, 36396 and 79722 made submissions. Now 20703 and 79722 were the only ones, so there are 2 unique hackers who made at least one submission each day. As each hacker made one submission so 20703 is considered to be the hacker who made maximum number of submissions on this day. The name of the hacker is Angela.</p>
<p>On March 04, 2016 hackers 20703, 44065, 53473 and 79722 made submissions. Now 20703 and 79722 only submitted each day, so there are 2 unique hackers who made at least one submission each day. As each hacker made one submission so 20703 is considered to be the hacker who made maximum number of submissions on this day. The name of the hacker is Angela.</p>
<p>On March 05, 2016 hackers 20703, 36396, 38289 and 62529 made submissions. Now 20703 only submitted each day, so there is only 1 unique hacker who made at least one submission each day. 36396 made 2 submissions and name of the hacker is Frank.</p>
<p>On March 06, 2016 only 20703 made submission, so there is only 1 unique hacker who made at least one submission each day. 20703 made 1 submission and name of the hacker is Angela.</p>
</div><div id="section2"><h2>解答</h2>
<p>以 PostgreSQL 写法作答:</p>
<pre><code class="lang-pgsql hljs">
WITH date_seq AS ( 
    SELECT generate_series(to_date('20160301', 'yyyymmdd')
                          ,to_date('20160306', 'yyyymmdd')
                          ,'1 day') AS submission_date
), attach_pre_date AS (
    SELECT s1.hacker_id
         , s1.submission_date
         , CASE WHEN s1.submission_date = '20160301'::date
                THEN s1.submission_date
                ELSE s2.submission_date
           END        AS pre_date
      FROM submissions s1
 LEFT JOIN submissions s2
        ON s2.hacker_id = s1.hacker_id
       AND s2.submission_date = s1.submission_date - 1
), stat_submission1 AS (
    SELECT t.submission_date
         , COUNT(DISTINCT t.hacker_id)  AS distinct_count
      FROM attach_pre_date t
     WHERE t.pre_date IS NOT NULL
  GROUP BY t.submission_date
), stat_submission2 AS ( 
    SELECT tmp.submission_date
         , tmp.hacker_id
         , ROW_NUMBER()
           OVER(PARTITION BY tmp.submission_date
                    ORDER BY tmp.hacker_submission_count DESC
                           , tmp.hacker_id ASC
               )    AS rn
      FROM (   SELECT t.submission_date
                    , t.hacker_id
                    , COUNT(1)       AS hacker_submission_count 
                 FROM attach_pre_date t
                WHERE t.pre_date IS NOT NULL
             GROUP BY t.submission_date, t.hacker_id
           ) tmp
)   SELECT ds.submission_date
         , ss1.distinct_count
         , ss2.hacker_id
         , h.name
      FROM date_seq ds
 LEFT JOIN stat_submission1 ss1
        ON ss1.submission_date = ds.submission_date
 LEFT JOIN stat_submission2 ss2
        ON ss2.submission_date = ds.submission_date
       AND ss2.rn = 1
 LEFT JOIN hackers h
        ON h.hacker_id = ss2.hacker_id
;

</code></pre></div>
        </div>
    </div>
</div>

<a href="https://paxinla.github.io/posts/2020/09/sqllian-shou-ti-number-of-unique-hackers-who-made-at-least-one-submission-each-day.html" class="current-page-link">本文链接: https://paxinla.github.io/posts/2020/09/sqllian-shou-ti-number-of-unique-hackers-who-made-at-least-one-submission-each-day.html</a>

<!-- Comments -->
<div class="content-split-comment"><hr class="dotty-split-line" /></div>
<div class="content-bottom">
<section class="comments" id="comments">
      <div class="panel panel-primary">
        <div class="panel-heading" role="tab" id="githubissue-heading">
          <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#githubissue-comments" aria-expanded="true" aria-controls="githubissue-comments">
                <i class="fa fa-comments"></i><i id="githubissue-comment_list"> Comments</i>
            </a>
          </h4>
        </div>

        <!-- utterances start -->
        <div id="utter-container"></div>
        <script src="https://utteranc.es/client.js"
          repo="paxinla/paxinla.github.io"
          issue-term="url"
          label="blog_comment"
          theme="boxy-light"
          crossorigin="anonymous"
          async>
        </script>
        <!-- utterances end -->

      </div>
</section>
            <div class="cc-license">
                <p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/"><img alt="知识共享许可协议" style="border-width:0;display:inline-block" src="https://licensebuttons.net/l/by-nc-sa/3.0/cn/88x31.png" /></a>&nbsp;本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" style="color:#00a67c">知识共享署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a>进行许可，欢迎转载、演绎，<br/>但是必须保留本文的署名 <a href="https://paxinla.github.io" style="color:rgb(153,51,51);">Charles</a>（包含链接），且不得用于商业目的。</p>
            </div>
            <div class="clearfix"></div>
        </div>

        </div><!-- End Whole Page -->

        <!-- Scripts -->
        <script src="https://paxinla.github.io/theme/js/packed.js?e4252eaf"></script>

        <script src="https://paxinla.github.io/theme/js/article_toc.js" type="text/javascript"></script>

        <!-- Sidebar / Table of Contents -->
        <script type="text/javascript">
         $(function(){$("#toc").tableOfContents(null,{
             startLevel: 2, depth: 1});
             $('body').scrollspy({
                 target: '#nav-sidebar',
                 offset: 20});
         });
        </script>

        <!-- Code Highlighting : highlight.js -->
        <script type="text/javascript">
            hljs.configure({languages:[]});
            hljs.initHighlightingOnLoad();
        </script>

        <!-- Equation Rendering : mathjax -->
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
               jax: ["input/TeX","output/CommonHTML"],
               tex2jax: { inlineMath: [["$","$"], ["\\(", "\\)"]] },
               CommonHTML: {
                   linebreaks: { automatic: true, width: "container" }
               }
            });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML" type="text/javascript"></script>

        <!-- Cat -->
        <script src="https://paxinla.github.io/theme/js/L2Dwidget.min.js"></script>
        <script type="text/javascript">
            var L2DModelArray = ['hijiki', 'tororo'];
            var L2DModelIndex = Math.floor((Math.random()*L2DModelArray.length));
            var L2DModelSelected = L2DModelArray[L2DModelIndex];
            L2Dwidget.init({model: {
                              jsonPath: "https://paxinla.github.io/theme/live2d-widget-model-"+L2DModelSelected+"/assets/"+L2DModelSelected+".model.json",
                            },
                            display: {
                              superSample: 2,
                              width: 100,
                              height: 200,
                              position: 'right',
                              hOffset: 0,
                              vOffset: 0,
                            },
                            mobile: {
                              show: true,
                              scale: 1,
                              motion: true,
                            },
                            react: {
                              opacityDefault: 0.85,
                              opacityOnHover: 0.2,
                            }
                          })
        </script>

        <!-- Funny title -->
        <script type="text/javascript">
            var OriginTitle = document.title;
            document.addEventListener('visibilitychange', function () {
                if (document.hidden) {
                    document.title = '_(:з」∠)_ 呀嚯嘿';
                } else {
                    document.title = OriginTitle;
                }
            });
        </script>
    </body>
</html>